{% extends "layout.html" %}
{% block content %}
<section class="events-page">

    <h1 class="page-title">{{ title }}</h1>

    <!-- MAIN EVENT FORM -->
    <form method="POST" class="event-form">
        {{ form.hidden_tag() }}

        <div class="form-field">
            {{ form.title.label(class="form-label") }}
            {{ form.title(class="form-input") }}
        </div>

        <div class="form-field">
            {{ form.event_datetime.label(class="form-label") }}
            {{ form.event_datetime(class="form-input") }}
        </div>

        <div class="form-field">
            {{ form.host.label(class="form-label") }}
            {{ form.host(class="form-input") }}
        </div>

        <div class="form-field">
            {{ form.description.label(class="form-label") }}
            {{ form.description(class="form-textarea large-textarea") }}
        </div>

        {% if current_user.is_host and event %}

        <h2 class="group-heading">Resources</h2>

        <div class="resource-list">
            {% for resource in event.resources %}
            <div class="resource-card">
                <a href="{{ resource.url }}" target="_blank" class="resource-title">
                    {{ resource.title }}
                </a>

                <!-- DELETE BUTTON MOVED OUTSIDE MAIN FORM -->
                <button class="icon-btn delete-btn"
                        formaction="{{ url_for('events.delete_resource', resource_id=resource.id) }}"
                        formmethod="POST">
                    ✕
                </button>

            </div>
            {% else %}
            <p class="event-details-line">No resources yet.</p>
            {% endfor %}
        </div>

        {% endif %}

        <!-- SAVE BUTTON (NOW WORKS) -->
        <div class="form-actions" style="margin-top: 30px;">
            {{ form.submit(class_="btn btn-create") }}
        </div>

    </form>
    <!-- END MAIN FORM -->


    {% if current_user.is_host and event %}

    <!-- ADD RESOURCE FORM -->
    <h3 class="group-heading" style="margin-top: 22px;">Add Resource</h3>

    <form method="POST"
          action="{{ url_for('events.add_resource', event_id=event.id) }}"
          class="resource-add-form">

        {{ resource_form.hidden_tag() }}

        <div class="form-field">
            {{ resource_form.title.label(class="form-label") }}
            {{ resource_form.title(class="form-input") }}
        </div>

        <div class="form-field">
            {{ resource_form.url.label(class="form-label") }}
            {{ resource_form.url(class="form-input") }}
        </div>

        <button class="btn btn-secondary small" type="submit">
            Add
        </button>
    </form>

    {% endif %}

    <p class="event-details-line" style="margin-top: 20px;">
        <a href="{{ url_for('events.events_list') }}">← Back to Events</a>
    </p>

</section>
{% endblock %}
